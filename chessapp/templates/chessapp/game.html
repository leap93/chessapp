{% load static %}
{% load extras %}
<p>{{ game.white_player}} against {{ game.black_player }}</p><br>
{% csrf_token %}

<table>


{% if player_color == "w" %}

	{% for x in board reversed %}
		<tr>
			{% for y in x %}
				<td>
				<img src="{% static y|add:'.png' %}" width="100" height="100" onclick="boardClick({{ forloop.counter0 }}, {{ 7|subtract:forloop.parentloop.counter0 }}, this);" id="{{ forloop.counter0 }}{{ 7|subtract:forloop.parentloop.counter0 }}">
				</td>
				{% endfor %}
		</tr>
	{% endfor %}

{% else %}

	{% for x in board %}
		<tr>
		{% for y in x reversed %}
			<td>
			<img src="{% static y|add:'.png' %}" width="100" height="100" onclick="boardClick({{ 7|subtract:forloop.counter0 }}, {{ forloop.parentloop.counter0 }}, this);" id="{{ 7|subtract:forloop.counter0 }}{{ forloop.parentloop.counter0 }}">
			</td>
		{% endfor %}
		</tr>
	{% endfor %}

{% endif %}


</table>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
	var selectedX = -1;
	var selectedY = -1;
	function boardClick(x, y){
		if("{{players_turn}}"=="False"){
			return
		}
		
		if(selectedX == -1){
			if(document.getElementById(x+""+y).src.includes("w.png") || document.getElementById(x+""+y).src.includes("b.png")){
				document.getElementById("message").innerHTML = "You chose an empty square!";
			}else{
				selectedX = x;
				selectedY = y;
				document.getElementById("message").innerHTML = "";
				
				document.getElementById(x+""+y).src = document.getElementById(x+""+y).src.replace("ww", "rw");
				document.getElementById(x+""+y).src = document.getElementById(x+""+y).src.replace("bw", "rw");
				document.getElementById(x+""+y).src = document.getElementById(x+""+y).src.replace("wb", "rb");
				document.getElementById(x+""+y).src = document.getElementById(x+""+y).src.replace("bb", "rb");
			}
			

		}else{
			// jquery extend function
			$.extend(
			{
				redirectPost: function(location, args)
				{
					var form = '';
					$.each( args, function( key, value ) {
						value = value.split('"').join('\"')
						form += '<input type="hidden" name="'+key+'" value="'+value+'">';
					});
					$('<form action="' + location + '" method="POST">' + form + '</form>').appendTo($(document.body)).submit();
				}
			});			
		
		
			var redirect = '{{ request.path }}?id={{request.GET.id}}';
			$.redirectPost(redirect, {fromX : selectedX.toString(), fromY: selectedY.toString(), toX: x.toString(), toY: y.toString()});
		}
	}
</script>
<p id="message">{{message}}</p>
